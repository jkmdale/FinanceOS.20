<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinanceOS - Financial Goals</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 25%, #312e81 50%, #1e1b4b 75%, #0f172a 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        /* Glass effect utility classes */
        .glass {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .glass-premium {
            background: linear-gradient(135deg, 
                rgba(139, 92, 246, 0.15) 0%, 
                rgba(59, 130, 246, 0.15) 50%, 
                rgba(147, 51, 234, 0.15) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        /* Gradient utility classes */
        .gradient-purple { background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 50%, #9333ea 100%); }
        .gradient-green { background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%); }
        .gradient-red { background: linear-gradient(135deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%); }
        .gradient-blue { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%); }
        .gradient-orange { background: linear-gradient(135deg, #f97316 0%, #ea580c 50%, #c2410c 100%); }
        .gradient-yellow { background: linear-gradient(135deg, #eab308 0%, #ca8a04 50%, #a16207 100%); }

        /* Header */
        .header {
            padding: 1rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo {
            width: 60px;
            height: 60px;
            margin: 0 auto 1rem;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        /* Container */
        .container {
            padding: 0 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Financial Health Overview */
        .health-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .health-card {
            padding: 1.5rem;
            border-radius: 16px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .health-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-color);
        }

        .health-card h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .health-card p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .health-status {
            font-size: 0.8rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            display: inline-block;
            margin-top: 0.5rem;
        }

        .status-critical { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        .status-warning { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
        .status-good { background: rgba(16, 185, 129, 0.2); color: #34d399; }

        /* Goals Grid */
        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .goal-card {
            padding: 2rem;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }

        .goal-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .goal-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .goal-info h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .goal-info p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .goal-progress {
            margin-bottom: 1.5rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.75rem;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .progress-current {
            font-weight: 600;
        }

        .progress-target {
            color: rgba(255, 255, 255, 0.7);
        }

        .goal-timeline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .timeline-item {
            text-align: center;
            flex: 1;
        }

        .timeline-label {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.25rem;
        }

        .timeline-value {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .goal-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .btn-primary {
            background: rgba(139, 92, 246, 0.8);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Monthly Progress Tracker */
        .progress-tracker {
            margin-bottom: 2rem;
        }

        .tracker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .tracker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .tracker-card {
            padding: 1.5rem;
            border-radius: 16px;
        }

        .tracker-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .month-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .month-info {
            display: flex;
            flex-direction: column;
        }

        .month-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .month-target {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .month-status {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        /* Quick Actions */
        .quick-actions {
            margin-bottom: 2rem;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .quick-action {
            padding: 1.5rem;
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .quick-action:hover {
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .quick-action-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }

        .quick-action h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .quick-action p {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Navigation */
        .nav-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 0.75rem;
            }
            
            .goals-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .goal-card {
                padding: 1.5rem;
            }
            
            .health-overview {
                grid-template-columns: 1fr;
            }
            
            .tracker-grid {
                grid-template-columns: 1fr;
            }
            
            .actions-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Celebration Effects */
        .milestone-celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #10b981, #059669);
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            z-index: 1000;
            display: none;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .celebration-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo gradient-green">üéØ</div>
        <h1>Financial Goals</h1>
        <p>Track your progress toward financial freedom</p>
    </div>

    <div class="container">
        <!-- Financial Health Overview -->
        <div class="health-overview">
            <div class="health-card glass-premium" style="--accent-color: #ef4444;">
                <h3 id="emergency-fund-amount">$0.17</h3>
                <p>Emergency Fund</p>
                <div class="health-status status-critical">CRITICAL</div>
            </div>
            <div class="health-card glass-premium" style="--accent-color: #f59e0b;">
                <h3 id="monthly-deficit">-$2,685</h3>
                <p>Monthly Cash Flow</p>
                <div class="health-status status-critical">DEFICIT</div>
            </div>
            <div class="health-card glass-premium" style="--accent-color: #8b5cf6;">
                <h3 id="debt-amount">$3,251</h3>
                <p>Credit Card Debt</p>
                <div class="health-status status-warning">HIGH</div>
            </div>
            <div class="health-card glass-premium" style="--accent-color: #10b981;">
                <h3 id="days-to-goals">89</h3>
                <p>Days to Break Even</p>
                <div class="health-status status-warning">ON TRACK</div>
            </div>
        </div>

        <!-- Goals Grid -->
        <div class="goals-grid">
            <!-- Emergency Fund Goal -->
            <div class="goal-card glass-premium">
                <div class="goal-header">
                    <div class="goal-icon gradient-red">üõ°Ô∏è</div>
                    <div class="goal-info">
                        <h3>Emergency Fund</h3>
                        <p>Build financial security buffer</p>
                    </div>
                </div>
                
                <div class="goal-progress">
                    <div class="progress-bar">
                        <div class="progress-fill gradient-red" style="width: 0.006%;" id="emergency-progress"></div>
                    </div>
                    <div class="progress-text">
                        <span class="progress-current">$0.17</span>
                        <span class="progress-target">of $3,000</span>
                    </div>
                </div>

                <div class="goal-timeline">
                    <div class="timeline-item">
                        <div class="timeline-label">Started</div>
                        <div class="timeline-value">Dec 2024</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-label">Target</div>
                        <div class="timeline-value">Dec 2025</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-label">Monthly</div>
                        <div class="timeline-value">$250</div>
                    </div>
                </div>

                <div class="goal-actions">
                    <button class="action-btn btn-primary" onclick="addToEmergencyFund()">üí∞ Add Money</button>
                    <button class="action-btn btn-secondary" onclick="editGoal('emergency')">‚öôÔ∏è Edit Goal</button>
                </div>
            </div>

            <!-- Budget Recovery Goal -->
            <div class="goal-card glass-premium">
                <div class="goal-header">
                    <div class="goal-icon gradient-orange">üìä</div>
                    <div class="goal-info">
                        <h3>Budget Recovery</h3>
                        <p>Eliminate monthly deficit</p>
                    </div>
                </div>
                
                <div class="goal-progress">
                    <div class="progress-bar">
                        <div class="progress-fill gradient-orange" style="width: 25%;" id="budget-progress"></div>
                    </div>
                    <div class="progress-text">
                        <span class="progress-current">-$2,685</span>
                        <span class="progress-target">to $0 (break even)</span>
                    </div>
                </div>

                <div class="goal-timeline">
                    <div class="timeline-item">
                        <div class="timeline-label">Current</div>
                        <div class="timeline-value">-$2,685</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-label">Month 2</div>
                        <div class="timeline-value">-$1,300</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-label">Month 3</div>
                        <div class="timeline-value">$0</div>
                    </div>
                </div>

                <div class="goal-actions">
                    <button class="action-btn btn-primary" onclick="updateBudgetProgress()">üìà Log Progress</button>
                    <button class="action-btn btn-secondary" onclick="viewBudgetPlan()">üìã View Plan</button>
                </div>
            </div>

            <!-- Debt Payoff Goal -->
            <div class="goal-card glass-premium">
                <div class="goal-header">
                    <div class="goal-icon gradient-yellow">üí≥</div>
                    <div class="goal-info">
                        <h3>Credit Card Payoff</h3>
                        <p>Eliminate high-interest debt</p>
                    </div>
                </div>
                
                <div class="goal-progress">
                    <div class="progress-bar">
                        <div class="progress-fill gradient-yellow" style="width: 12%;" id="debt-progress"></div>
                    </div>
                    <div class="progress-text">
                        <span class="progress-current">$3,251</span>
                        <span class="progress-target">to $0</span>
                    </div>
                </div>

                <div class="goal-timeline">
                    <div class="timeline-item">
                        <div class="timeline-label">Balance</div>
                        <div class="timeline-value">$3,251</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-label">Payment</div>
                        <div class="timeline-value">$200/mo</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-label">Payoff</div>
                        <div class="timeline-value">18 months</div>
                    </div>
                </div>

                <div class="goal-actions">
                    <button class="action-btn btn-primary" onclick="makeDebtPayment()">üí∞ Make Payment</button>
                    <button class="action-btn btn-secondary" onclick="optimizePayoff()">‚ö° Optimize</button>
                </div>
            </div>

            <!-- Savings Goal -->
            <div class="goal-card glass-premium">
                <div class="goal-header">
                    <div class="goal-icon gradient-green">üí∞</div>
                    <div class="goal-info">
                        <h3>Monthly Surplus</h3>
                        <p>Build sustainable savings</p>
                    </div>
                </div>
                
                <div class="goal-progress">
                    <div class="progress-bar">
                        <div class="progress-fill gradient-green" style="width: 0%;" id="savings-progress"></div>
                    </div>
                    <div class="progress-text">
                        <span class="progress-current">-$2,685</span>
                        <span class="progress-target">to +$500</span>
                    </div>
                </div>

                <div class="goal-timeline">
                    <div class="timeline-item">
                        <div class="timeline-label">Target</div>
                        <div class="timeline-value">+$500</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-label">Rate</div>
                        <div class="timeline-value">12%</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-label">Timeline</div>
                        <div class="timeline-value">6 months</div>
                    </div>
                </div>

                <div class="goal-actions">
                    <button class="action-btn btn-primary" onclick="trackSavings()">üìä Track</button>
                    <button class="action-btn btn-secondary" onclick="autoSave()">üîÑ Auto-Save</button>
                </div>
            </div>
        </div>

        <!-- Monthly Progress Tracker -->
        <div class="progress-tracker glass-premium" style="border-radius: 20px; padding: 2rem;">
            <div class="tracker-header">
                <h3 style="font-size: 1.3rem; font-weight: 600;">3-Month Recovery Progress</h3>
                <div style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">Track your journey to financial stability</div>
            </div>
            
            <div class="tracker-grid">
                <div class="tracker-card glass">
                    <div class="tracker-title">
                        üî• Month 1: Emergency Actions
                    </div>
                    <div class="month-progress">
                        <div class="month-info">
                            <div class="month-name">Deficit Reduction</div>
                            <div class="month-target">Target: -$1,300 (50% cut)</div>
                        </div>
                        <div class="month-status status-warning">IN PROGRESS</div>
                    </div>
                    <div class="month-progress">
                        <div class="month-info">
                            <div class="month-name">Emergency Fund</div>
                            <div class="month-target">Target: $100</div>
                        </div>
                        <div class="month-status status-critical">BEHIND</div>
                    </div>
                    <div class="month-progress">
                        <div class="month-info">
                            <div class="month-name">Expense Cuts</div>
                            <div class="month-target">Food: $600, Shopping: $300</div>
                        </div>
                        <div class="month-status status-warning">STARTING</div>
                    </div>
                </div>

                <div class="tracker-card glass">
                    <div class="tracker-title">
                        ‚ö° Month 2: Habit Building
                    </div>
                    <div class="month-progress">
                        <div class="month-info">
                            <div class="month-name">Break Even</div>
                            <div class="month-target">Target: $0 monthly deficit</div>
                        </div>
                        <div class="month-status" style="background: rgba(107, 114, 128, 0.2); color: #9ca3af;">PENDING</div>
                    </div>
                    <div class="month-progress">
                        <div class="month-info">
                            <div class="month-name">Emergency Fund</div>
                            <div class="month-target">Target: $350</div>
                        </div>
                        <div class="month-status" style="background: rgba(107, 114, 128, 0.2); color: #9ca3af;">PENDING</div>
                    </div>
                    <div class="month-progress">
                        <div class="month-info">
                            <div class="month-name">Additional Income</div>
                            <div class="month-target">Target: +$300/month</div>
                        </div>
                        <div class="month-status" style="background: rgba(107, 114, 128, 0.2); color: #9ca3af;">PENDING</div>
                    </div>
                </div>

                <div class="tracker-card glass">
                    <div class="tracker-title">
                        üöÄ Month 3: Surplus Building
                    </div>
                    <div class="month-progress">
                        <div class="month-info">
                            <div class="month-name">Monthly Surplus</div>
                            <div class="month-target">Target: +$324</div>
                        </div>
                        <div class="month-status" style="background: rgba(107, 114, 128, 0.2); color: #9ca3af;">PENDING</div>
                    </div>
                    <div class="month-progress">
                        <div class="month-info">
                            <div class="month-name">Emergency Fund</div>
                            <div class="month-target">Target: $750</div>
                        </div>
                        <div class="month-status" style="background: rgba(107, 114, 128, 0.2); color: #9ca3af;">PENDING</div>
                    </div>
                    <div class="month-progress">
                        <div class="month-info">
                            <div class="month-name">Debt Payments</div>
                            <div class="month-target">Extra $100 to credit card</div>
                        </div>
                        <div class="month-status" style="background: rgba(107, 114, 128, 0.2); color: #9ca3af;">PENDING</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h3 style="margin-bottom: 1rem; text-align: center;">Quick Actions</h3>
            <div class="actions-grid">
                <div class="quick-action glass" onclick="quickAddEmergencyFund()">
                    <div class="quick-action-icon">üõ°Ô∏è</div>
                    <h4>Add to Emergency Fund</h4>
                    <p>Quickly log emergency fund deposits</p>
                </div>
                
                <div class="quick-action glass" onclick="logExpenseReduction()">
                    <div class="quick-action-icon">‚úÇÔ∏è</div>
                    <h4>Log Expense Cut</h4>
                    <p>Track money saved from budget cuts</p>
                </div>
                
                <div class="quick-action glass" onclick="recordIncomeIncrease()">
                    <div class="quick-action-icon">üí∞</div>
                    <h4>Record Extra Income</h4>
                    <p>Log additional income sources</p>
                </div>
                
                <div class="quick-action glass" onclick="updateDebtBalance()">
                    <div class="quick-action-icon">üí≥</div>
                    <h4>Update Debt Balance</h4>
                    <p>Track credit card payments</p>
                </div>
                
                <div class="quick-action glass" onclick="setWeeklyTarget()">
                    <div class="quick-action-icon">üéØ</div>
                    <h4>Set Weekly Target</h4>
                    <p>Define this week's financial goals</p>
                </div>
                
                <div class="quick-action glass" onclick="viewProgress()">
                    <div class="quick-action-icon">üìà</div>
                    <h4>View Detailed Progress</h4>
                    <p>Analyze your financial journey</p>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-buttons">
            <a href="csv-upload.html" class="nav-btn gradient-purple" style="color: white;">üìä Financial Analysis</a>
            <a href="index.html" class="nav-btn" style="background: rgba(255,255,255,0.1); color: white;">‚Üê Back to Dashboard</a>
            <button class="nav-btn gradient-green" style="color: white;" onclick="generateProgressReport()">üìã Progress Report</button>
        </div>
    </div>

    <!-- Celebration Modal -->
    <div class="overlay" id="overlay"></div>
    <div class="milestone-celebration" id="celebration">
        <div class="celebration-icon">üéâ</div>
        <h3 id="celebration-title">Milestone Achieved!</h3>
        <p id="celebration-message">You've reached a new financial milestone!</p>
        <button class="action-btn btn-primary" onclick="closeCelebration()" style="margin-top: 1rem;">Continue</button>
    </div>

    <script>
        // Goal tracking data (in real app, this would come from your database)
        let goalData = {
            emergencyFund: {
                current: 0.17,
                target: 3000,
                monthlyTarget: 250,
                startDate: '2024-12-01',
                targetDate: '2025-12-01'
            },
            budgetRecovery: {
                currentDeficit: -2685,
                targetSurplus: 324,
                monthlyReduction: 1000,
                timeline: 3 // months
            },
            creditCardDebt: {
                current: 3251,
                target: 0,
                monthlyPayment: 200,
                interestRate: 0.18
            },
            monthlySavings: {
                current: -2685,
                target: 500,
                timeline: 6 // months
            }
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updateAllProgress();
            checkMilestones();
            loadUserProgress();
        });

        function updateAllProgress() {
            updateEmergencyFundProgress();
            updateBudgetProgress();
            updateDebtProgress();
            updateSavingsProgress();
            updateHealthOverview();
        }

        function updateEmergencyFundProgress() {
            const progress = (goalData.emergencyFund.current / goalData.emergencyFund.target) * 100;
            document.getElementById('emergency-progress').style.width = `${Math.max(progress, 0.5)}%`;
            
            // Update display amounts
            const currentElements = document.querySelectorAll('.progress-current');
            if (currentElements[0]) {
                currentElements[0].textContent = `$${goalData.emergencyFund.current.toFixed(2)}`;
            }
        }

        function updateBudgetProgress() {
            const totalReduction = Math.abs(goalData.budgetRecovery.currentDeficit);
            const targetReduction = totalReduction + goalData.budgetRecovery.targetSurplus;
            const progress = (1000 / targetReduction) * 100; // Assuming $1000 reduction so far
            document.getElementById('budget-progress').style.width = `${progress}%`;
        }

        function updateDebtProgress() {
            const progress = (500 / goalData.creditCardDebt.current) * 100; // Assuming $500 paid so far
            document.getElementById('debt-progress').style.width = `${progress}%`;
        }

        function updateSavingsProgress() {
            const totalImprovement = Math.abs(goalData.monthlySavings.current) + goalData.monthlySavings.target;
            const progress = (500 / totalImprovement) * 100; // Assuming $500 improvement so far
            document.getElementById('savings-progress').style.width = `${progress}%`;
        }

        function updateHealthOverview() {
            // Emergency fund status
            if (goalData.emergencyFund.current < 500) {
                updateHealthCard('emergency-fund-amount', `$${goalData.emergencyFund.current.toFixed(2)}`, 'CRITICAL', 'status-critical');
            } else if (goalData.emergencyFund.current < 1500) {
                updateHealthCard('emergency-fund-amount', `$${goalData.emergencyFund.current.toFixed(2)}`, 'LOW', 'status-warning');
            } else {
                updateHealthCard('emergency-fund-amount', `$${goalData.emergencyFund.current.toFixed(2)}`, 'GOOD', 'status-good');
            }

            // Calculate days to break even
            const monthsToBreakEven = Math.abs(goalData.budgetRecovery.currentDeficit) / goalData.budgetRecovery.monthlyReduction;
            const daysToBreakEven = Math.ceil(monthsToBreakEven * 30);
            document.getElementById('days-to-goals').textContent = daysToBreakEven;
        }

        function updateHealthCard(elementId, value, status, statusClass) {
            document.getElementById(elementId).textContent = value;
            const statusElement = document.getElementById(elementId).nextElementSibling.nextElementSibling;
            statusElement.textContent = status;
            statusElement.className = `health-status ${statusClass}`;
        }

        // Quick action functions
        function quickAddEmergencyFund() {
            const amount = prompt('How much did you add to your emergency fund?', '25');
            if (amount && !isNaN(amount)) {
                const addAmount = parseFloat(amount);
                goalData.emergencyFund.current += addAmount;
                updateEmergencyFundProgress();
                updateHealthOverview();
                
                // Show celebration if milestone reached
                if (goalData.emergencyFund.current >= 100 && goalData.emergencyFund.current - addAmount < 100) {
                    showCelebration('First $100 Saved!', 'Great job building your emergency fund foundation!');
                }
                
                saveProgress();
                showSuccess(`Added $${addAmount} to emergency fund!`);
            }
        }

        function logExpenseReduction() {
            const categories = ['Food & Dining', 'Shopping & Retail', 'Entertainment', 'Other'];
            const category = prompt(`Which category did you reduce spending in?\n${categories.map((c, i) => `${i + 1}. ${c}`).join('\n')}`);
            const amount = prompt('How much did you save this week?', '50');
            
            if (amount && !isNaN(amount)) {
                const savedAmount = parseFloat(amount);
                // Update budget recovery progress
                goalData.budgetRecovery.currentDeficit += savedAmount; // Reduce deficit
                updateBudgetProgress();
                saveProgress();
                showSuccess(`Great! You saved $${savedAmount} in ${categories[parseInt(category) - 1] || 'expenses'}!`);
            }
        }

        function recordIncomeIncrease() {
            const sources = ['Side Work', 'Freelancing', 'Selling Items', 'Bonus', 'Other'];
            const source = prompt(`What's your additional income source?\n${sources.map((s, i) => `${i + 1}. ${s}`).join('\n')}`);
            const amount = prompt('How much extra income this month?', '200');
            
            if (amount && !isNaN(amount)) {
                const incomeAmount = parseFloat(amount);
                goalData.budgetRecovery.currentDeficit += incomeAmount; // Reduce deficit
                updateBudgetProgress();
                updateHealthOverview();
                saveProgress();
                showSuccess(`Excellent! $${incomeAmount} extra income from ${sources[parseInt(source) - 1] || 'additional source'}!`);
            }
        }

        function updateDebtBalance() {
            const currentBalance = prompt('What\'s your current credit card balance?', goalData.creditCardDebt.current);
            if (currentBalance && !isNaN(currentBalance)) {
                const newBalance = parseFloat(currentBalance);
                const paidAmount = goalData.creditCardDebt.current - newBalance;
                
                if (paidAmount > 0) {
                    goalData.creditCardDebt.current = newBalance;
                    updateDebtProgress();
                    document.getElementById('debt-amount').textContent = `$${newBalance.toFixed(0)}`;
                    
                    if (newBalance === 0) {
                        showCelebration('Debt Free!', 'Congratulations! You\'ve paid off your credit card!');
                    }
                    
                    saveProgress();
                    showSuccess(`Great! You paid off $${paidAmount.toFixed(2)}!`);
                } else {
                    showSuccess('Balance updated.');
                }
            }
        }

        function setWeeklyTarget() {
            const targets = [
                'Spend max $150 on food',
                'No shopping purchases over $50',
                'Cook at home 5 days',
                'Find one subscription to cancel',
                'Earn $100 extra income'
            ];
            
            const target = prompt(`Choose your weekly target:\n${targets.map((t, i) => `${i + 1}. ${t}`).join('\n')}\n\nOr enter your own:`);
            
            if (target) {
                const targetText = isNaN(target) ? target : targets[parseInt(target) - 1];
                localStorage.setItem('weeklyTarget', targetText);
                showSuccess(`Weekly target set: ${targetText}`);
            }
        }

        function viewProgress() {
            const progress = calculateOverallProgress();
            alert(`Your Financial Recovery Progress:\n\n` +
                  `Emergency Fund: ${((goalData.emergencyFund.current / goalData.emergencyFund.target) * 100).toFixed(1)}%\n` +
                  `Budget Recovery: ${progress.budget.toFixed(1)}%\n` +
                  `Debt Reduction: ${progress.debt.toFixed(1)}%\n` +
                  `Overall Progress: ${progress.overall.toFixed(1)}%\n\n` +
                  `Keep going! You're on track to financial stability!`);
        }

        function generateProgressReport() {
            const report = {
                timestamp: new Date().toISOString(),
                emergencyFund: {
                    current: goalData.emergencyFund.current,
                    target: goalData.emergencyFund.target,
                    progress: ((goalData.emergencyFund.current / goalData.emergencyFund.target) * 100).toFixed(1) + '%'
                },
                budgetRecovery: {
                    currentDeficit: goalData.budgetRecovery.currentDeficit,
                    targetSurplus: goalData.budgetRecovery.targetSurplus,
                    monthsToGoal: Math.ceil(Math.abs(goalData.budgetRecovery.currentDeficit) / goalData.budgetRecovery.monthlyReduction)
                },
                debt: {
                    current: goalData.creditCardDebt.current,
                    monthsToPayoff: Math.ceil(goalData.creditCardDebt.current / goalData.creditCardDebt.monthlyPayment)
                }
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `financeos-progress-report-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showSuccess('Progress report downloaded!');
        }

        // Goal management functions
        function addToEmergencyFund() {
            quickAddEmergencyFund();
        }

        function editGoal(goalType) {
            if (goalType === 'emergency') {
                const newTarget = prompt('What\'s your emergency fund target?', goalData.emergencyFund.target);
                if (newTarget && !isNaN(newTarget)) {
                    goalData.emergencyFund.target = parseFloat(newTarget);
                    updateEmergencyFundProgress();
                    saveProgress();
                    showSuccess(`Emergency fund target updated to $${newTarget}!`);
                }
            }
        }

        function updateBudgetProgress() {
            alert('Budget progress tracking coming soon! For now, use the "Log Expense Cut" and "Record Extra Income" quick actions.');
        }

        function viewBudgetPlan() {
            window.location.href = 'csv-upload.html';
        }

        function makeDebtPayment() {
            updateDebtBalance();
        }

        function optimizePayoff() {
            const extraPayment = prompt('How much extra can you pay monthly toward debt?', '50');
            if (extraPayment && !isNaN(extraPayment)) {
                const extra = parseFloat(extraPayment);
                const newMonthlyPayment = goalData.creditCardDebt.monthlyPayment + extra;
                const monthsToPayoff = Math.ceil(goalData.creditCardDebt.current / newMonthlyPayment);
                const interestSaved = goalData.creditCardDebt.current * (goalData.creditCardDebt.interestRate / 12) * 
                                   (Math.ceil(goalData.creditCardDebt.current / goalData.creditCardDebt.monthlyPayment) - monthsToPayoff);
                
                alert(`Debt Optimization Results:\n\n` +
                      `New monthly payment: $${newMonthlyPayment}\n` +
                      `Payoff time: ${monthsToPayoff} months\n` +
                      `Interest saved: $${interestSaved.toFixed(2)}\n\n` +
                      `This saves you ${Math.ceil(goalData.creditCardDebt.current / goalData.creditCardDebt.monthlyPayment) - monthsToPayoff} months!`);
            }
        }

        function trackSavings() {
            viewProgress();
        }

        function autoSave() {
            alert('Auto-save feature coming soon! This will automatically transfer surplus funds to savings.');
        }

        // Utility functions
        function calculateOverallProgress() {
            const emergencyProgress = (goalData.emergencyFund.current / goalData.emergencyFund.target) * 100;
            const budgetProgress = ((Math.abs(goalData.budgetRecovery.currentDeficit) - 2685) / Math.abs(goalData.budgetRecovery.currentDeficit)) * 100;
            const debtProgress = ((3251 - goalData.creditCardDebt.current) / 3251) * 100;
            
            return {
                emergency: emergencyProgress,
                budget: Math.max(budgetProgress, 0),
                debt: Math.max(debtProgress, 0),
                overall: (emergencyProgress + Math.max(budgetProgress, 0) + Math.max(debtProgress, 0)) / 3
            };
        }

        function checkMilestones() {
            // Check for milestones and show celebrations
            const lastCheck = localStorage.getItem('lastMilestoneCheck');
            const today = new Date().toDateString();
            
            if (lastCheck !== today) {
                // Check various milestones
                if (goalData.emergencyFund.current >= 100 && parseFloat(localStorage.getItem('lastEmergencyAmount') || '0') < 100) {
                    showCelebration('First $100 Saved!', 'You\'ve built the foundation of your emergency fund!');
                }
                
                localStorage.setItem('lastMilestoneCheck', today);
                localStorage.setItem('lastEmergencyAmount', goalData.emergencyFund.current.toString());
            }
        }

        function showCelebration(title, message) {
            document.getElementById('celebration-title').textContent = title;
            document.getElementById('celebration-message').textContent = message;
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('celebration').style.display = 'block';
        }

        function closeCelebration() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('celebration').style.display = 'none';
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 12px;
                font-weight: 500;
                z-index: 1000;
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            `;
            successDiv.textContent = message;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }

        function saveProgress() {
            localStorage.setItem('financeOS_goalData', JSON.stringify(goalData));
        }

        function loadUserProgress() {
            const savedData = localStorage.getItem('financeOS_goalData');
            if (savedData) {
                const saved = JSON.parse(savedData);
                // Merge saved data with defaults
                goalData = { ...goalData, ...saved };
                updateAllProgress();
            }
        }

        // Load saved weekly target
        const savedTarget = localStorage.getItem('weeklyTarget');
        if (savedTarget) {
            // Could display this somewhere on the page
            console.log('Current weekly target:', savedTarget);
        }
    </script>
</body>
</html>
