<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FinanceOS - Dashboard</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#8b5cf6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        /* CSS Variables for Premium Design System */
        :root {
            --primary-bg: linear-gradient(135deg, #0f172a 0%, #1e1b4b 25%, #312e81 50%, #1e1b4b 75%, #0f172a 100%);
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-premium: linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(59, 130, 246, 0.15) 50%, rgba(147, 51, 234, 0.15) 100%);
            --glass-border: rgba(255, 255, 255, 0.15);
            --glass-premium-border: rgba(255, 255, 255, 0.2);
            --text-primary: rgba(255, 255, 255, 0.9);
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.5);
            --gradient-purple: linear-gradient(135deg, #8b5cf6 0%, #a855f7 50%, #9333ea 100%);
            --gradient-blue: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
            --gradient-green: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            --gradient-red: linear-gradient(135deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%);
            --gradient-orange: linear-gradient(135deg, #f97316 0%, #ea580c 50%, #c2410c 100%);
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Glass Effects */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .glass-premium {
            background: var(--glass-premium);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-premium-border);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        /* Gradients */
        .gradient-purple { background: var(--gradient-purple); }
        .gradient-blue { background: var(--gradient-blue); }
        .gradient-green { background: var(--gradient-green); }
        .gradient-red { background: var(--gradient-red); }
        .gradient-orange { background: var(--gradient-orange); }

        /* Transitions */
        .transition-all { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .hover-scale:hover { transform: scale(1.05); }
        .hover-glow:hover { box-shadow: 0 0 20px rgba(139, 92, 246, 0.5); }

        /* Header Styles */
        .header {
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 12px 20px;
            border-radius: 0;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            color: white;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-purple);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .logo-icon img {
            width: 32px;
            height: 32px;
            object-fit: contain;
        }

        .nav {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-button {
            padding: 8px 20px;
            border-radius: 12px;
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 16px;
            transition: all 0.3s ease;
            border: none;
            background: transparent;
            cursor: pointer;
            position: relative;
        }

        .nav-button:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-button.active {
            color: white;
            background: rgba(139, 92, 246, 0.3);
        }

        .nav-button.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: #8b5cf6;
            border-radius: 50%;
        }

        .privacy-toggle {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .privacy-toggle:hover {
            background: rgba(245, 158, 11, 0.3);
        }

        .logout-button {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .logout-button:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* Main Content */
        .main-content {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* CSV Status Banner */
        .csv-status {
            background: var(--gradient-orange);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 500;
        }

        .csv-status a {
            color: white;
            text-decoration: underline;
        }

        /* Emergency Alert */
        .emergency-alert {
            background: var(--gradient-red);
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 24px;
            animation: pulse 2s infinite;
        }

        .alert-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .alert-text {
            font-size: 14px;
            line-height: 1.5;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }

        /* Section Styles */
        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
            color: white;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        /* Financial Summary */
        .financial-summary {
            margin-bottom: 32px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .summary-card {h
            padding: 24px;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(139, 92, 246, 0.3);
        }

        .summary-card h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .amount {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 4px;
            font-variant-numeric: tabular-nums;
        }

        .change {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Account Cards */
        .accounts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .account-card {
            padding: 20px;
            border-radius: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .account-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(139, 92, 246, 0.2);
        }

        .account-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .account-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .account-info h3 {
            font-size: 16px;
            font-weight: 600;
            color: white;
            margin-bottom: 2px;
        }

        .account-type {
            font-size: 12px;
            color: var(--text-muted);
        }

        .account-balance {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
            font-variant-numeric: tabular-nums;
        }

        .account-available {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Goals Section */
        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .goal-card {
            padding: 20px;
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .goal-title {
            font-size: 16px;
            font-weight: 600;
            color: white;
        }

        .goal-priority {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .priority-critical {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .priority-high {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .priority-medium {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .goal-progress {
            margin-bottom: 12px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Quick Actions */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .action-card {
            padding: 24px;
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: white;
        }

        .action-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(139, 92, 246, 0.3);
        }

        .action-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .action-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .action-subtitle {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* AI Coach */
        .ai-coach {
            margin-bottom: 32px;
        }

        .chat-container {
            padding: 20px;
            border-radius: 16px;
            max-height: 400px;
            overflow-y: auto;
        }

        .chat-messages {
            margin-bottom: 16px;
            max-height: 300px;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 12px;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
        }

        .message.user {
            background: var(--gradient-purple);
            margin-left: auto;
            color: white;
        }

        .message.ai {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .chat-input {
            display: flex;
            gap: 12px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: white;
            font-size: 14px;
        }

        .chat-input input::placeholder {
            color: var(--text-muted);
        }

        .chat-input button {
            padding: 12px 16px;
            background: var(--gradient-purple);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            font-weight: 600;
        }

        /* Login Styles */
        .session-info {
            display: none !important;
        }

        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .login-container {
            background: var(--glass-premium);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-premium-border);
            border-radius: 24px;
            padding: 60px 50px;
            text-align: center;
            max-width: 600px;
            width: 95%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            min-height: 700px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            margin: 20px;
        }

        .login-logo {
            width: 90px;
            height: 90px;
            background: var(--gradient-purple);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
        }

        .login-logo img {
            width: 70%;
            height: 70%;
            object-fit: contain;
        }

        .login-input {
            width: 100%;
            padding: 18px 22px;
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 14px;
            color: white;
            font-size: 20px;
            box-sizing: border-box;
        }

        .login-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .login-input:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.15);
        }

        .login-button {
            width: 100%;
            padding: 18px;
            background: var(--gradient-purple);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }

        .login-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 28px rgba(139, 92, 246, 0.5);
        }

        .biometric-button {
            width: 100%;
            padding: 18px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 14px;
            font-size: 20px;
            cursor: pointer;
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }

        .biometric-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            font-size: 20px;
        }

        .password-field {
            position: relative;
        }

        .pin-input {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }

        .pin-digit {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 28px;
            text-align: center;
            font-weight: bold;
        }

        .pin-digit:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.15);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 12px;
            }

            .nav {
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
            }

            .nav-button {
                font-size: 14px;
                padding: 6px 12px;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .accounts-grid {
                grid-template-columns: 1fr;
            }

            .goals-grid {
                grid-template-columns: 1fr;
            }

            .actions-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .amount {
                font-size: 24px;
            }

            .login-container {
                padding: 40px 30px;
                min-height: 600px;
            }
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .loading { opacity: 0.6; pointer-events: none; }
        .text-success { color: var(--success); }
        .text-error { color: var(--error); }
        .text-warning { color: var(--warning); }
        .text-info { color: var(--info); }

        /* Privacy Mode */
        body.privacy-mode .amount,
        body.privacy-mode .account-balance {
            filter: blur(8px);
            transition: filter 0.3s ease;
        }

        body.privacy-mode .amount:hover,
        body.privacy-mode .account-balance:hover {
            filter: blur(0);
        }
    </style>
</head>
<body>
    <div class="session-info" id="sessionInfo" style="display: none;">
        <span>User: demo</span>
        <button class="logout-button" onclick="logout()">Logout</button>
    </div>

    <div class="login-overlay" id="loginOverlay">
        <div class="login-container">
            <div class="login-logo">
                <span style="font-size: 48px; color: white;">$</span>
            </div>
            <h2 style="color: white; margin-bottom: 12px; font-size: 28px;">FinanceOS</h2>
            <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 40px; font-size: 16px;">
                Your Personal Finance Operating System
            </p>
            
            <div id="loginForm">
                <input type="text" id="loginUsername" class="login-input" placeholder="Username" autocomplete="username">
                
                <div class="password-field">
                    <input type="password" id="loginPassword" class="login-input" placeholder="Password" autocomplete="current-password">
                    <button type="button" class="password-toggle" onclick="togglePassword()">üëÅÔ∏è</button>
                </div>
                
                <button onclick="login()" class="login-button" id="loginButton">
                    <span id="loginButtonText">Login</span>
                </button>
                
                <button onclick="showBiometricLogin()" class="biometric-button" id="biometricButton">
                    üîê Use Biometric Login
                </button>
                
                <button onclick="showPinLogin()" class="biometric-button">
                    üî¢ Use PIN
                </button>
                
                <div style="margin-top: 20px;">
                    <a href="#" onclick="showPasswordReset()" style="color: #8b5cf6; text-decoration: none;">Forgot Password?</a>
                </div>
                
                <div style="margin-top: 20px; font-size: 12px; color: rgba(255, 255, 255, 0.6);">
                    Demo: username=<strong>demo</strong>, password=<strong>demo123</strong>
                </div>
            </div>
            
            <div id="pinForm" style="display: none;">
                <h3 style="color: white; margin-bottom: 20px;">Enter PIN</h3>
                <div class="pin-input">
                    <input type="password" class="pin-digit" maxlength="1" id="pin1" oninput="movePinFocus(1)" onkeydown="handlePinBackspace(event, 1)">
                    <input type="password" class="pin-digit" maxlength="1" id="pin2" oninput="movePinFocus(2)" onkeydown="handlePinBackspace(event, 2)">
                    <input type="password" class="pin-digit" maxlength="1" id="pin3" oninput="movePinFocus(3)" onkeydown="handlePinBackspace(event, 3)">
                    <input type="password" class="pin-digit" maxlength="1" id="pin4" oninput="movePinFocus(4)" onkeydown="handlePinBackspace(event, 4)">
                </div>
                <button onclick="loginWithPin()" class="login-button">Login with PIN</button>
                <button onclick="showLoginForm()" class="biometric-button">Back to Password</button>
                <div style="margin-top: 15px; font-size: 12px; color: rgba(255, 255, 255, 0.6);">
                    Demo PIN: <strong>1234</strong>
                </div>
            </div>
            
            <div id="resetForm" style="display: none;">
                <h3 style="color: white; margin-bottom: 20px;">Reset Password</h3>
                <input type="email" class="login-input" placeholder="Email Address" id="resetEmail">
                <button onclick="sendPasswordReset()" class="login-button">Send Reset Link</button>
                <button onclick="showLoginForm()" class="biometric-button">Back to Login</button>
            </div>
        </div>
    </div>

    <div id="mainApp" style="display: none;">
        <header class="header glass">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <span style="font-size: 24px; color: white;">$</span>
                    </div>
                    <span class="logo-text">FinanceOS</span>
                </div>
                
                <nav class="nav">
                    <a href="index.html" class="nav-button active">Dashboard</a>
                    <a href="csv-upload.html" class="nav-button">Upload CSV</a>
                    <a href="goals.html" class="nav-button">Goals</a>
                    <a href="budget.html" class="nav-button">Budget</a>
                    <button class="privacy-toggle nav-button" id="privacyToggle">üîí Privacy</button>
                    <button class="logout-button nav-button" onclick="logout()">üö™ Logout</button>
                </nav>
            </div>
        </header>

        <main class="main-content" id="mainContent">
            <div class="csv-status" id="csvStatus">
                üìä No recent CSV data found. <a href="csv-upload.html">Upload bank statements</a> to see transaction analysis.
            </div>

            <div class="emergency-alert">
                <div class="alert-title">üö® Financial Alert: Emergency Fund Critical</div>
                <div class="alert-text">
                    Your emergency fund has only $0.17. With a monthly deficit of $3,607, you're at high financial risk. 
                    <strong>Immediate action required.</strong>
                </div>
            </div>

            <section class="financial-summary">
                <h2 class="section-title">Financial Overview</h2>
                
                <div class="summary-grid">
                    <div class="summary-card glass-premium hover-scale transition-all">
                        <h3>Total Assets</h3>
                        <div class="amount text-success">$114,116.44</div>
                        <div class="change">Available across all accounts</div>
                    </div>
                    
                    <div class="summary-card glass-premium hover-scale transition-all">
                        <h3>Total Debt</h3>
                        <div class="amount text-error">$274,851.32</div>
                        <div class="change">Including mortgage & credit</div>
                    </div>
                    
                    <div class="summary-card glass-premium hover-scale transition-all">
                        <h3>Net Worth</h3>
                        <div class="amount text-error">-$160,734.88</div>
                        <div class="change">Improving with debt payoff</div>
                    </div>
                    
                    <div class="summary-card glass-premium hover-scale transition-all">
                        <h3>Monthly Cash Flow</h3>
                        <div class="amount text-error">-$3,607</div>
                        <div class="change">Expenses exceed income</div>
                    </div>
                </div>
            </section>

            <section class="accounts-section">
                <div class="section-header">
                    <h2 class="section-title">Your Accounts</h2>
                </div>

                <div class="accounts-grid">
                    <div class="account-card glass hover-scale transition-all">
                        <div class="account-header">
                            <div class="account-icon gradient-blue">üí≥</div>
                            <div class="account-info">
                                <h3>My Spending</h3>
                                <div class="account-type">Personal Checking</div>
                            </div>
                        </div>
                        <div class="account-balance text-success">$25.92</div>
                        <div class="account-available">$25.92 Available</div>
                    </div>

                    <div class="account-card glass hover-scale transition-all">
                        <div class="account-header">
                            <div class="account-icon gradient-green">üí∞</div>
                            <div class="account-info">
                                <h3>My Savings</h3>
                                <div class="account-type">Personal Savings</div>
                            </div>
                        </div>
                        <div class="account-balance text-warning">$0.17</div>
                        <div class="account-available">$0.17 Available</div>
                    </div>

                    <div class="account-card glass hover-scale transition-all">
                        <div class="account-header">
                            <div class="account-icon gradient-purple">üè†</div>
                            <div class="account-info">
                                <h3>House Kitty</h3>
                                <div class="account-type">Joint Savings</div>
                            </div>
                        </div>
                        <div class="account-balance text-success">$65,357.00</div>
                        <div class="account-available">$65,357.00 Available</div>
                    </div>

                    <div class="account-card glass hover-scale transition-all">
                        <div class="account-header">
                            <div class="account-icon gradient-orange">üìÑ</div>
                            <div class="account-info">
                                <h3>Mortgage & Billing</h3>
                                <div class="account-type">Bill Payment Account</div>
                            </div>
                        </div>
                        <div class="account-balance text-success">$126.35</div>
                        <div class="account-available">$126.35 Available</div>
                    </div>

                    <div class="account-card glass hover-scale transition-all">
                        <div class="account-header">
                            <div class="account-icon gradient-blue">üîÑ</div>
                            <div class="account-info">
                                <h3>Holding</h3>
                                <div class="account-type">Temporary Account</div>
                            </div>
                        </div>
                        <div class="account-balance text-success">$240.40</div>
                        <div class="account-available">$240.40 Available</div>
                    </div>

                    <div class="account-card glass hover-scale transition-all">
                        <div class="account-header">
                            <div class="account-icon gradient-red">üí≥</div>
                            <div class="account-info">
                                <h3>Low Rate Visa</h3>
                                <div class="account-type">Credit Card</div>
                            </div>
                        </div>
                        <div class="account-balance text-error">-$3,251.30</div>
                        <div class="account-available">$6,748.70 Available</div>
                    </div>

                    <div class="account-card glass hover-scale transition-all">
                        <div class="account-header">
                            <div class="account-icon gradient-green">üìà</div>
                            <div class="account-info">
                                <h3>ANZ KiwiSaver</h3>
                                <div class="account-type">Retirement Savings</div>
                            </div>
                        </div>
                        <div class="account-balance text-success">$48,733.44</div>
                        <div class="account-available">Growing for retirement</div>
                    </div>

                    <div class="account-card glass hover-scale transition-all">
                        <div class="account-header">
                            <div class="account-icon gradient-red">üè†</div>
                            <div class="account-info">
                                <h3>Home Loans</h3>
                                <div class="account-type">Mortgage Debt</div>
                            </div>
                        </div>
                        <div class="account-balance text-error">$271,600.02</div>
                        <div class="account-available">Principal remaining</div>
                    </div>
                </div>
            </section>

            <section class="goals-section">
                <div class="section-header">
                    <h2 class="section-title">Financial Goals</h2>
                    <a href="goals.html" class="nav-button">View All Goals</a>
                </div>

                <div class="goals-grid">
                    <div class="goal-card glass-premium">
                        <div class="goal-header">
                            <div class="goal-title">Emergency Fund</div>
                            <div class="goal-priority priority-critical">CRITICAL</div>
                        </div>
                        <div class="goal-progress">
                            <div class="progress-bar">
                                <div class="progress-fill gradient-red" style="width: 0.001%"></div>
                            </div>
                            <div class="progress-text">
                                <span>$0.17 of $15,000</span>
                                <span>0.001%</span>
                            </div>
                        </div>
                        <div style="font-size: 12px; color: var(--text-muted);">
                            Target: 3 months of expenses
                        </div>
                    </div>

                    <div class="goal-card glass-premium">
                        <div class="goal-header">
                            <div class="goal-title">Visa Debt Payoff</div>
                            <div class="goal-priority priority-high">HIGH</div>
                        </div>
                        <div class="goal-progress">
                            <div class="progress-bar">
                                <div class="progress-fill gradient-orange" style="width: 67.5%"></div>
                            </div>
                            <div class="progress-text">
                                <span>$6,748.70 paid of $10,000</span>
                                <span>67.5%</span>
                            </div>
                        </div>
                        <div style="font-size: 12px; color: var(--text-muted);">
                            $3,251.30 remaining
                        </div>
                    </div>

                    <div class="goal-card glass-premium">
                        <div class="goal-header">
                            <div class="goal-title">KiwiSaver Growth</div>
                            <div class="goal-priority priority-medium">MEDIUM</div>
                        </div>
                        <div class="goal-progress">
                            <div class="progress-bar">
                                <div class="progress-fill gradient-green" style="width: 48.7%"></div>
                            </div>
                            <div class="progress-text">
                                <span>$48,733 of $100,000</span>
                                <span>48.7%</span>
                            </div>
                        </div>
                        <div style="font-size: 12px; color: var(--text-muted);">
                            Retirement milestone target
                        </div>
                    </div>

                    <div class="goal-card glass-premium">
                        <div class="goal-header">
                            <div class="goal-title">Private School Fund</div>
                            <div class="goal-priority priority-medium">MEDIUM</div>
                        </div>
                        <div class="goal-progress">
                            <div class="progress-bar">
                                <div class="progress-fill gradient-blue" style="width: 15%"></div>
                            </div>
                            <div class="progress-text">
                                <span>$1,500 of $10,000</span>
                                <span>15%</span>
                            </div>
                        </div>
                        <div style="font-size: 12px; color: var(--text-muted);">
                            $300/month contributions
                        </div>
                    </div>
                </div>
            </section>

            <section class="quick-actions">
                <div class="section-header">
                    <h2 class="section-title">Quick Actions</h2>
                </div>

                <div class="actions-grid">
                    <a href="csv-upload.html" class="action-card glass-premium hover-scale transition-all gradient-purple">
                        <div class="action-icon">üì§</div>
                        <div class="action-title">Upload CSV</div>
                        <div class="action-subtitle">Import bank statements</div>
                    </a>

                    <a href="budget.html" class="action-card glass-premium hover-scale transition-all gradient-blue">
                        <div class="action-icon">üìä</div>
                        <div class="action-title">View Budget</div>
                        <div class="action-subtitle">Track spending vs budget</div>
                    </a>

                    <a href="goals.html" class="action-card glass-premium hover-scale transition-all gradient-green">
                        <div class="action-icon">üéØ</div>
                        <div class="action-title">Manage Goals</div>
                        <div class="action-subtitle">Update financial targets</div>
                    </a>

                    <a href="#" onclick="openTransferModal()" class="action-card glass-premium hover-scale transition-all gradient-orange">
                        <div class="action-icon">üí∏</div>
                        <div class="action-title">Transfer Money</div>
                        <div class="action-subtitle">Move funds between accounts</div>
                    </a>

                    <a href="#" onclick="openPaymentModal()" class="action-card glass-premium hover-scale transition-all gradient-red">
                        <div class="action-icon">üí≥</div>
                        <div class="action-title">Pay Bills</div>
                        <div class="action-subtitle">Schedule payments</div>
                    </a>

                    <a href="#" onclick="generateReport()" class="action-card glass-premium hover-scale transition-all gradient-purple">
                        <div class="action-icon">üìà</div>
                        <div class="action-title">Generate Report</div>
                        <div class="action-subtitle">Financial summary</div>
                    </a>
                </div>
            </section>

            <section class="ai-coach">
                <div class="section-header">
                    <h2 class="section-title">AI Financial Coach</h2>
                </div>

                <div class="chat-container glass-premium">
                    <div class="chat-messages" id="chatMessages">
                        <div class="message ai">
                            <strong>üí° AI Coach:</strong> Welcome! I've analyzed your finances and noticed your emergency fund is critically low at $0.17. With your current monthly deficit of $3,607, this puts you at high financial risk. Would you like me to create an action plan to address this immediately?
                        </div>
                    </div>
                    
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="Ask me about your spending, budget, or goals..." onkeypress="handleChatKeyPress(event)">
                        <button onclick="sendChatMessage()">Send</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Application State
        let isLoggedIn = false;
        let privacyMode = false;
        let currentUser = null;

        // Financial Data
        const accountData = {
            assets: {
                mySpending: 25.92,
                mySavings: 0.17,
                houseKitty: 65357.00,
                mortgageBilling: 126.35,
                holding: 240.40,
                kiwiSaver: 48733.44
            },
            liabilities: {
                lowRateVisa: 3251.30,
                homeLoans: 271600.02
            },
            budget: {
                income: 6304,
                expenses: 9911,
                deficit: -3607
            }
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            checkAuthState();
        });

        function initializeApp() {
            // Check for saved auth state
            const savedAuth = localStorage.getItem('financeos_auth');
            if (savedAuth) {
                const authData = JSON.parse(savedAuth);
                if (authData.expires > Date.now()) {
                    showMainApp();
                }
            }

            // Initialize privacy mode
            const savedPrivacy = localStorage.getItem('financeos_privacy');
            if (savedPrivacy === 'true') {
                togglePrivacyMode();
            }
        }

        function setupEventListeners() {
            // Privacy toggle
            const privacyToggle = document.getElementById('privacyToggle');
            if (privacyToggle) {
                privacyToggle.addEventListener('click', togglePrivacyMode);
            }

            // Chat input enter key
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', handleChatKeyPress);
            }
        }

        function checkAuthState() {
            const authToken = localStorage.getItem('financeos_auth');
            if (authToken) {
                try {
                    const authData = JSON.parse(authToken);
                    if (authData.expires > Date.now()) {
                        showMainApp();
                        return;
                    }
                } catch (e) {
                    console.error('Invalid auth token');
                }
            }
            showLogin();
        }

        // Authentication Functions
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const button = document.getElementById('loginButton');
            const buttonText = document.getElementById('loginButtonText');

            if (!username || !password) {
                alert('Please enter both username and password');
                return;
            }

            // Demo authentication
            if (username === 'demo' && password === 'demo123') {
                button.disabled = true;
                buttonText.innerHTML = '<div class="loading-spinner"></div>';

                setTimeout(() => {
                    const authData = {
                        user: 'demo',
                        expires: Date.now() + (7 * 24 * 60 * 60 * 1000) // 7 days
                    };
                    localStorage.setItem('financeos_auth', JSON.stringify(authData));
                    showMainApp();
                }, 1500);
            } else {
                alert('Invalid credentials. Use demo/demo123');
            }
        }

        function loginWithPin() {
            const pin1 = document.getElementById('pin1').value;
            const pin2 = document.getElementById('pin2').value;
            const pin3 = document.getElementById('pin3').value;
            const pin4 = document.getElementById('pin4').value;
            const pin = pin1 + pin2 + pin3 + pin4;

            if (pin === '1234') {
                const authData = {
                    user: 'demo',
                    expires: Date.now() + (7 * 24 * 60 * 60 * 1000)
                };
                localStorage.setItem('financeos_auth', JSON.stringify(authData));
                showMainApp();
            } else {
                alert('Invalid PIN. Use 1234');
            }
        }

        function showBiometricLogin() {
            if ('credentials' in navigator && 'create' in navigator.credentials) {
                navigator.credentials.get({
                    publicKey: {
                        challenge: new Uint8Array(32),
                        timeout: 60000,
                        userVerification: "required"
                    }
                }).then(() => {
                    const authData = {
                        user: 'demo',
                        expires: Date.now() + (7 * 24 * 60 * 60 * 1000)
                    };
                    localStorage.setItem('financeos_auth', JSON.stringify(authData));
                    showMainApp();
                }).catch(() => {
                    alert('Biometric authentication not available or failed');
                });
            } else {
                alert('Biometric authentication not supported on this device');
            }
        }

        function showPinLogin() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('pinForm').style.display = 'block';
            document.getElementById('pin1').focus();
        }

        function showLoginForm() {
            document.getElementById('pinForm').style.display = 'none';
            document.getElementById('resetForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        }

        function showPasswordReset() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('resetForm').style.display = 'block';
        }

        function sendPasswordReset() {
            const email = document.getElementById('resetEmail').value;
            if (email) {
                alert('Password reset link sent to ' + email);
                showLoginForm();
            } else {
                alert('Please enter your email address');
            }
        }

        function logout() {
            localStorage.removeItem('financeos_auth');
            localStorage.removeItem('financeos_privacy');
            showLogin();
        }

        function showLogin() {
            document.getElementById('loginOverlay').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            isLoggedIn = false;
        }

        function showMainApp() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            isLoggedIn = true;
            updateDashboard();
        }

        // UI Functions
        function togglePassword() {
            const passwordField = document.getElementById('loginPassword');
            const toggle = document.querySelector('.password-toggle');
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                toggle.textContent = 'üôà';
            } else {
                passwordField.type = 'password';
                toggle.textContent = 'üëÅÔ∏è';
            }
        }

        function movePinFocus(current) {
            if (current < 4) {
                const nextField = document.getElementById('pin' + (current + 1));
                if (nextField) nextField.focus();
            }
        }

        function handlePinBackspace(event, current) {
            if (event.key === 'Backspace' && current > 1) {
                const currentField = document.getElementById('pin' + current);
                if (currentField.value === '') {
                    const prevField = document.getElementById('pin' + (current - 1));
                    if (prevField) {
                        prevField.focus();
                        prevField.value = '';
                    }
                }
            }
        }

        function togglePrivacyMode() {
            privacyMode = !privacyMode;
            document.body.classList.toggle('privacy-mode', privacyMode);
            
            const toggle = document.getElementById('privacyToggle');
            if (toggle) {
                toggle.textContent = privacyMode ? 'üîì Show Data' : 'üîí Privacy';
            }
            
            localStorage.setItem('financeos_privacy', privacyMode.toString());
        }

        function updateDashboard() {
            // Update CSV status
            const csvStatus = document.getElementById('csvStatus');
            const lastUpload = localStorage.getItem('financeos_last_csv_upload');
            
            if (lastUpload) {
                const uploadDate = new Date(lastUpload);
                const daysSince = Math.floor((Date.now() - uploadDate.getTime()) / (1000 * 60 * 60 * 24));
                
                if (daysSince <= 7) {
                    csvStatus.className = 'csv-status recent-data';
                    csvStatus.innerHTML = `‚úÖ Recent CSV data from ${daysSince} day${daysSince !== 1 ? 's' : ''} ago. Transactions categorized and budget updated.`;
                } else {
                    csvStatus.className = 'csv-status old-data';
                    csvStatus.innerHTML = `‚ö†Ô∏è CSV data is ${daysSince} days old. <a href="csv-upload.html">Upload recent statements</a> for accurate tracking.`;
                }
            }
        }

        // AI Coach Functions
        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            // Add user message
            addChatMessage('user', message);
            input.value = '';

            // Simulate AI response
            setTimeout(() => {
                const response = generateAIResponse(message);
                addChatMessage('ai', response);
            }, 1000);
        }

        function addChatMessage(type, message) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            if (type === 'ai') {
                messageDiv.innerHTML = `<strong>üí° AI Coach:</strong> ${message}`;
            } else {
                messageDiv.textContent = message;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function generateAIResponse(query) {
            const lowerQuery = query.toLowerCase();
            
            if (lowerQuery.includes('emergency') || lowerQuery.includes('fund')) {
                return "Your emergency fund is critically low at $0.17. I recommend immediately redirecting $100/week from discretionary spending to build this to at least $1,000 within 10 weeks. This would provide basic protection while we work on your budget deficit.";
            }
            
            if (lowerQuery.includes('budget') || lowerQuery.includes('deficit')) {
                return "Your monthly deficit of $3,607 is unsustainable. Key areas to address: 1) Reduce dining out budget from $250 to $100 (-$150), 2) Review Sky Network subscription ($163) - consider cheaper alternatives, 3) Optimize grocery spending from $550 to $450 (-$100). These changes alone could reduce deficit by $413/month.";
            }
            
            if (lowerQuery.includes('debt') || lowerQuery.includes('visa')) {
                return "Your Visa debt of $3,251 is costing approximately $54/month in interest (assuming 20% APR). Focus on paying this off before building savings beyond emergency fund. Pay minimum + any extra you can afford to save on interest charges.";
            }
            
            if (lowerQuery.includes('goal') || lowerQuery.includes('save')) {
                return "With your current deficit, focus on these priorities: 1) Emergency fund to $1,000 (critical), 2) Eliminate budget deficit, 3) Pay off Visa debt, 4) Build emergency fund to $15,000, 5) Then focus on other goals like private school fund.";
            }
            
            if (lowerQuery.includes('house') || lowerQuery.includes('kitty')) {
                return "Your House Kitty has $65,357 - excellent! This provides good security for home repairs and maintenance. Consider if any portion could temporarily help with your budget deficit, but maintain at least $30,000 for true house emergencies.";
            }
            
            return "I understand you're asking about your finances. Your top priorities should be: 1) Build emergency fund to $1,000 immediately, 2) Address the $3,607 monthly deficit through expense reduction, 3) Pay off high-interest debt. Would you like specific advice on any of these areas?";
        }

        // Quick Action Functions
        function openTransferModal() {
            alert('Transfer functionality would open here. This would allow moving money between your accounts.');
        }

        function openPaymentModal() {
            alert('Bill payment functionality would open here. This would show upcoming bills and allow scheduling payments.');
        }

        function generateReport() {
            alert('Report generation would create a comprehensive financial summary PDF. This feature will be available soon.');
        }

        // PWA Installation
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install prompt after user is logged in
            if (isLoggedIn) {
                showInstallPrompt();
            }
        });

        function showInstallPrompt() {
            if (deferredPrompt) {
                const installBanner = document.createElement('div');
                installBanner.innerHTML = `
                    <div style="position: fixed; bottom: 20px; right: 20px; background: var(--glass-premium); backdrop-filter: blur(20px); border: 1px solid var(--glass-premium-border); border-radius: 16px; padding: 16px; max-width: 300px; z-index: 1000;">
                        <h4 style="margin: 0 0 8px 0; color: white;">Install FinanceOS</h4>
                        <p style="margin: 0 0 12px 0; font-size: 12px; color: var(--text-secondary);">Add to home screen for the best experience</p>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="installPWA()" style="background: var(--gradient-purple); color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 12px; cursor: pointer;">Install</button>
                            <button onclick="dismissInstall()" style="background: transparent; color: var(--text-secondary); border: 1px solid var(--glass-border); padding: 8px 16px; border-radius: 8px; font-size: 12px; cursor: pointer;">Later</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(installBanner);
            }
        }

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA installed');
                    }
                    deferredPrompt = null;
                    dismissInstall();
                });
            }
        }

        function dismissInstall() {
            const banner = document.querySelector('[style*="position: fixed; bottom: 20px"]');
            if (banner) {
                banner.remove();
            }
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>