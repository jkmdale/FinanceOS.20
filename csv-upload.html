<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#8b5cf6">
    <meta name="description" content="Upload bank statements and financial data">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FinanceOS">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="manifest.json">
    
    <title>Upload Bank Statements - FinanceOS</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/papaparse/5.4.1/papaparse.min.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/upload.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="main-nav glass">
        <div class="nav-container">
            <div class="nav-brand">
                <svg width="48" height="48" viewBox="0 0 512 512" class="nav-logo">
                    <rect width="512" height="512" rx="115" fill="url(#backgroundGradient)"/>
                    <circle cx="256" cy="256" r="140" fill="url(#centralGradient)"/>
                    <text x="256" y="280" text-anchor="middle" font-size="120" font-weight="bold" fill="white">$</text>
                    <defs>
                        <linearGradient id="backgroundGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#6366f1"/>
                            <stop offset="50%" stop-color="#8b5cf6"/>
                            <stop offset="100%" stop-color="#3b82f6"/>
                        </linearGradient>
                        <linearGradient id="centralGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#10b981" stop-opacity="0.9"/>
                            <stop offset="100%" stop-color="#059669" stop-opacity="0.9"/>
                        </linearGradient>
                    </defs>
                </svg>
                <span class="nav-title">FinanceOS</span>
            </div>
            
            <div class="nav-menu" id="navMenu">
                <a href="index.html" class="nav-link" data-page="dashboard">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <rect x="9" y="9" width="6" height="6"/>
                        <path d="m9 1 0 8"/>
                        <path d="m15 1 0 8"/>
                        <path d="m1 9 8 0"/>
                        <path d="m1 15 8 0"/>
                    </svg>
                    Dashboard
                    <div class="nav-indicator"></div>
                </a>
                <a href="budget.html" class="nav-link" data-page="budget">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <line x1="12" y1="1" x2="12" y2="23"/>
                        <path d="m17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                    </svg>
                    Budget
                    <div class="nav-indicator"></div>
                </a>
                <a href="goals.html" class="nav-link" data-page="goals">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"/>
                        <polygon points="16.24,7.76 14.12,14.12 7.76,16.24 9.88,9.88 16.24,7.76"/>
                    </svg>
                    Goals
                    <div class="nav-indicator"></div>
                </a>
                <a href="csv-upload.html" class="nav-link active" data-page="upload">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7,10 12,15 17,10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Upload
                    <div class="nav-indicator"></div>
                </a>
            </div>
            
            <div class="nav-actions">
                <button class="privacy-toggle" id="privacyToggle" title="Toggle Privacy Mode">
                    <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </button>
                <button class="hamburger" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <header class="page-header">
            <div class="header-content">
                <div class="title-section">
                    <h1 class="page-title">Upload Bank Statements</h1>
                    <p class="page-subtitle">Import CSV files from your New Zealand bank accounts</p>
                </div>
                <div class="upload-stats glass-premium">
                    <div class="stat-item">
                        <span class="stat-value" id="totalUploads">0</span>
                        <span class="stat-label">Files Uploaded</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="totalTransactions">0</span>
                        <span class="stat-label">Transactions</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="lastUpload">Never</span>
                        <span class="stat-label">Last Upload</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Bank Support Info -->
        <section class="bank-support">
            <div class="support-card glass">
                <div class="support-header">
                    <h3>Supported NZ Banks</h3>
                    <span class="support-badge">All Major Banks</span>
                </div>
                <div class="bank-grid">
                    <div class="bank-item">
                        <div class="bank-logo">ANZ</div>
                        <span>ANZ Bank</span>
                    </div>
                    <div class="bank-item">
                        <div class="bank-logo">ASB</div>
                        <span>ASB Bank</span>
                    </div>
                    <div class="bank-item">
                        <div class="bank-logo">BNZ</div>
                        <span>BNZ</span>
                    </div>
                    <div class="bank-item">
                        <div class="bank-logo">KB</div>
                        <span>Kiwibank</span>
                    </div>
                    <div class="bank-item">
                        <div class="bank-logo">WBC</div>
                        <span>Westpac</span>
                    </div>
                    <div class="bank-item">
                        <div class="bank-logo">+</div>
                        <span>Others</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Upload Instructions -->
        <section class="upload-instructions">
            <div class="instructions-card glass-premium">
                <div class="instructions-header">
                    <div class="instructions-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 16v-4"/>
                            <path d="M12 8h.01"/>
                        </svg>
                    </div>
                    <h3>How to Download Bank Statements</h3>
                </div>
                
                <div class="instructions-content">
                    <div class="instruction-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Log into Online Banking</h4>
                            <p>Access your internet banking through your bank's website or mobile app</p>
                        </div>
                    </div>
                    
                    <div class="instruction-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Navigate to Statements</h4>
                            <p>Find the "Statements" or "Transaction History" section</p>
                        </div>
                    </div>
                    
                    <div class="instruction-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Select Date Range</h4>
                            <p>Choose the last week or month of transactions</p>
                        </div>
                    </div>
                    
                    <div class="instruction-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Export as CSV</h4>
                            <p>Download the file in CSV, Excel, or QIF format</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- File Upload Area -->
        <section class="upload-section">
            <div class="upload-container">
                <!-- Drag & Drop Zone -->
                <div class="drop-zone glass-premium" id="dropZone">
                    <div class="drop-zone-content" id="dropZoneContent">
                        <div class="upload-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7,10 12,15 17,10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                        </div>
                        <h3>Drag & Drop Bank Files Here</h3>
                        <p>Or click to browse and select files</p>
                        <div class="supported-formats">
                            <span class="format-tag">CSV</span>
                            <span class="format-tag">Excel</span>
                            <span class="format-tag">QIF</span>
                            <span class="format-tag">OFX</span>
                        </div>
                    </div>
                    
                    <!-- Upload Progress -->
                    <div class="upload-progress" id="uploadProgress" style="display: none;">
                        <div class="progress-header">
                            <h4>Processing Files...</h4>
                            <span class="progress-percentage" id="progressPercentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-details" id="progressDetails">
                            Analyzing file format...
                        </div>
                    </div>
                    
                    <input type="file" id="fileInput" multiple accept=".csv,.xls,.xlsx,.qif,.ofx" style="display: none;">
                </div>

                <!-- Upload Options -->
                <div class="upload-options">
                    <div class="option-group">
                        <h4>Account Assignment</h4>
                        <div class="account-selector">
                            <label class="account-option">
                                <input type="radio" name="accountType" value="my-spending" checked>
                                <span class="option-content">
                                    <span class="option-title">My Spending Account</span>
                                    <span class="option-desc">Personal transaction account</span>
                                </span>
                            </label>
                            
                            <label class="account-option">
                                <input type="radio" name="accountType" value="joint-savings">
                                <span class="option-content">
                                    <span class="option-title">Joint Savings</span>
                                    <span class="option-desc">Shared household account</span>
                                </span>
                            </label>
                            
                            <label class="account-option">
                                <input type="radio" name="accountType" value="credit-card">
                                <span class="option-content">
                                    <span class="option-title">Credit Card</span>
                                    <span class="option-desc">Credit card transactions</span>
                                </span>
                            </label>
                        </div>
                    </div>

                    <div class="option-group">
                        <h4>Processing Options</h4>
                        <div class="processing-options">
                            <label class="checkbox-option">
                                <input type="checkbox" id="autoCategorize" checked>
                                <span class="checkmark"></span>
                                <span class="option-text">Automatically categorize transactions</span>
                            </label>
                            
                            <label class="checkbox-option">
                                <input type="checkbox" id="duplicateCheck" checked>
                                <span class="checkmark"></span>
                                <span class="option-text">Check for duplicate transactions</span>
                            </label>
                            
                            <label class="checkbox-option">
                                <input type="checkbox" id="updateBudget" checked>
                                <span class="checkmark"></span>
                                <span class="option-text">Update budget with actual spending</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Upload Results -->
        <section class="upload-results" id="uploadResults" style="display: none;">
            <div class="results-header">
                <h3>Upload Results</h3>
                <div class="results-summary" id="resultsSummary">
                    <!-- Results will be populated here -->
                </div>
            </div>
            
            <div class="results-content">
                <div class="results-tabs">
                    <button class="tab-btn active" onclick="showTab('transactions')">
                        Transactions
                        <span class="tab-count" id="transactionCount">0</span>
                    </button>
                    <button class="tab-btn" onclick="showTab('categorization')">
                        Categorization
                        <span class="tab-count" id="categorizationCount">0</span>
                    </button>
                    <button class="tab-btn" onclick="showTab('errors')">
                        Issues
                        <span class="tab-count" id="errorCount">0</span>
                    </button>
                </div>
                
                <div class="tab-content">
                    <!-- Transactions Tab -->
                    <div class="tab-panel active" id="transactionsPanel">
                        <div class="transactions-table">
                            <table id="transactionsTable">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Description</th>
                                        <th>Category</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsBody">
                                    <!-- Transaction rows will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Categorization Tab -->
                    <div class="tab-panel" id="categorizationPanel">
                        <div class="categorization-summary">
                            <h4>AI Categorization Results</h4>
                            <div class="category-breakdown" id="categoryBreakdown">
                                <!-- Category breakdown will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Errors Tab -->
                    <div class="tab-panel" id="errorsPanel">
                        <div class="error-list" id="errorList">
                            <!-- Errors will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="results-actions">
                <button class="btn-secondary" onclick="clearResults()">Clear Results</button>
                <button class="btn-primary" onclick="confirmUpload()">Confirm & Save</button>
            </div>
        </section>

        <!-- Recent Uploads -->
        <section class="recent-uploads">
            <div class="section-header">
                <h3>Recent Uploads</h3>
                <button class="view-all-btn" onclick="viewAllUploads()">View All</button>
            </div>
            
            <div class="uploads-list" id="uploadsList">
                <div class="upload-item">
                    <div class="upload-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10,9 9,9 8,9"/>
                        </svg>
                    </div>
                    <div class="upload-details">
                        <div class="upload-name">ANZ_Statement_Dec2024.csv</div>
                        <div class="upload-meta">My Spending • 47 transactions • 2 days ago</div>
                    </div>
                    <div class="upload-status success">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22,4 12,14.01 9,11.01"/>
                        </svg>
                        Success
                    </div>
                </div>

                <div class="upload-item">
                    <div class="upload-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10,9 9,9 8,9"/>
                        </svg>
                    </div>
                    <div class="upload-details">
                        <div class="upload-name">Kiwibank_Transactions_Nov2024.csv</div>
                        <div class="upload-meta">Joint Savings • 23 transactions • 1 week ago</div>
                    </div>
                    <div class="upload-status success">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22,4 12,14.01 9,11.01"/>
                        </svg>
                        Success
                    </div>
                </div>

                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7,10 12,15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                    </div>
                    <h4>No uploads yet</h4>
                    <p>Upload your first bank statement to get started</p>
                </div>
            </div>
        </section>

        <!-- Security Notice -->
        <section class="security-notice">
            <div class="notice-card glass">
                <div class="notice-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <circle cx="12" cy="16" r="1"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                </div>
                <div class="notice-content">
                    <h4>Your Data is Secure</h4>
                    <ul>
                        <li>Files are processed locally in your browser</li>
                        <li>No raw banking data is sent to external servers</li>
                        <li>All data is encrypted and stored securely</li>
                        <li>You control all data sharing and deletion</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <!-- Processing Modal -->
    <div class="processing-modal" id="processingModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content glass-premium">
            <div class="processing-content">
                <div class="processing-spinner">
                    <svg viewBox="0 0 50 50">
                        <circle cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-dasharray="31.416" stroke-dashoffset="31.416">
                            <animate attributeName="stroke-array" dur="2s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
                            <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
                        </circle>
                    </svg>
                </div>
                <h3>Processing Bank Statement</h3>
                <p id="processingStatus">Analyzing file format...</p>
                <div class="processing-steps">
                    <div class="step completed">
                        <span class="step-icon">✓</span>
                        File validation
                    </div>
                    <div class="step active">
                        <span class="step-icon">...</span>
                        Bank format detection
                    </div>
                    <div class="step">
                        <span class="step-icon"></span>
                        Transaction parsing
                    </div>
                    <div class="step">
                        <span class="step-icon"></span>
                        AI categorization
                    </div>
                    <div class="step">
                        <span class="step-icon"></span>
                        Duplicate checking
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/app.js"></script>
    <script src="js/upload.js"></script>
    <script src="js/csv-parser.js"></script>
    <script src="js/privacy.js"></script>
</body>
</html>